<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Model Selection</title>
  <meta name="description" content="Introduction to Model Selection">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Model Selection" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="janalin/model-selection-intro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Model Selection" />
  
  
  



<meta name="date" content="2018-04-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://janalin.github.io/model-selection-intro/">Introduction to Model Selection</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="bias-var.html"><a href="bias-var.html"><i class="fa fa-check"></i><b>2</b> The Bias-Variance Tradeoff</a><ul>
<li class="chapter" data-level="2.1" data-path="bias-var.html"><a href="bias-var.html#the-quality-of-fit-in-regression"><i class="fa fa-check"></i><b>2.1</b> The quality of fit in regression</a></li>
<li class="chapter" data-level="2.2" data-path="bias-var.html"><a href="bias-var.html#simulation-study"><i class="fa fa-check"></i><b>2.2</b> Simulation study</a></li>
<li class="chapter" data-level="2.3" data-path="bias-var.html"><a href="bias-var.html#error-decomposition"><i class="fa fa-check"></i><b>2.3</b> Error decomposition</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Model Selection</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bias-var" class="section level1">
<h1><span class="header-section-number">2</span> The Bias-Variance Tradeoff</h1>
<div id="the-quality-of-fit-in-regression" class="section level2">
<h2><span class="header-section-number">2.1</span> The quality of fit in regression</h2>
<p>Quality of fit means usually how well our model <span class="math inline">\(\hat{f}\)</span> matches the experimental observations <span class="math inline">\(y\)</span>. Or more precisely, how much the predicted response value for a given observation <span class="math inline">\(\hat{f}(x_i) = \hat{y}_i\)</span> is close to the observed response value <span class="math inline">\(y(x_i)\)</span> for that observation <span class="math inline">\(x_i\)</span>. The <span class="math inline">\(SSE\)</span> introduced in the previous section is not applicable because it is sample size dependent: as more observations we have, as higher the <span class="math inline">\(SSE\)</span>. Thus, we need to normalize for the number of observation <span class="math inline">\(n\)</span>. This gives us the most-commonly used measure for the quality of fit in regression analysis – the <em>mean squared error</em> <span class="math inline">\(MSE\)</span>:</p>
<p><span class="math display">\[MSE = \dfrac{1}{n} SSE = \dfrac{1}{n} \sum_{i = 1}^n \left( y(x_i) - \hat{f}(x_i) \right) ^ 2 = \dfrac{1}{n} \sum_{i = 1}^n \underbrace{ \left(\underbrace{\underbrace{y_i}_{\text{observed}} - \underbrace{\hat{y}_i}_{\text{predicted}}}_{\text{residual } r_i}\right)^2}_{\text{squared error}} \ , \]</span>
The MSE is the total mean error between our actual observations and model prediction. In the following section, we will see that there are different error sources that contribute to the total error (<span class="math inline">\(SSE\)</span> and <span class="math inline">\(MSE\)</span>).</p>
</div>
<div id="simulation-study" class="section level2">
<h2><span class="header-section-number">2.2</span> Simulation study</h2>
<p>We perform a simulation study with the four example models introduced in section <a href="intro.html#intro">1</a>.</p>
<span class="math display">\[\begin{align}
\hat{f}_1 (x) &amp;= \beta_0 + \beta_1 \ x &amp;\text{Polynomial of degree 1 (linear model)} \\
\hat{f}_2 (x) &amp;= \beta_0 + \beta_1 \ x + \beta_2 \ x^2 &amp;\text{Polynomial of degree 2 (quadratic model)} \\
\hat{f}_3 (x) &amp;= \beta_0 + \beta_1 \ x + \beta_2 \ x^2 + \ldots + \beta_{16} \ x^{15} &amp; \text{Polynomial of degree 15} \\
\hat{f}_4 (x) &amp;= \beta_0 + \beta_1 \ exp(x) &amp; \text{Exponential model} \\
\end{align}\]</span>
<p>All models share the same vector of independent variables <span class="math inline">\(x\)</span>. Note, that model <span class="math inline">\(\hat{f}_{3}\)</span> can include models <span class="math inline">\(\hat{f}_{i&lt;3}\)</span> (and <span class="math inline">\(\hat{f}_{2}\)</span> can include <span class="math inline">\(\hat{f}_{1}\)</span>), while model <span class="math inline">\(\hat{f}_4\)</span> belongs to a different category. We will see why this is important.</p>
<p>Assume you have a set of observations <span class="math inline">\(y\)</span> given by some data-generating process for given values of <span class="math inline">\(x\)</span>. For instance, <span class="math inline">\(x\)</span> might be a set of experimental conditions or a set of patient biomarkers. Then <span class="math inline">\(y\)</span> might correspond to a fluorescence signal under the condition <span class="math inline">\(x\)</span> or a disease outcome in the considered patient population. Note, that you do not observe the full population from which <span class="math inline">\(y\)</span> is drawn but only a sample; performing another experiment under conditions <span class="math inline">\(x\)</span> or collecting more patient samples for the considered patient population corresponds ideally to taking a new random sample from the same population. We try to design our experiments and studies such that we can assume that this is the case, otherwise we cannot use the discussed model selection criteria, because then we cannot assume that the observations come from the same data-generating process and then they can not be explained by the same model <span class="math inline">\(\hat{f}\)</span>.</p>
<p>We assume there is some <em>real</em> unknown model <span class="math inline">\(f\)</span> that gives rise to our observations <span class="math inline">\(y\)</span>:
<span class="math display">\[ y =  f(x) + \epsilon, \quad \epsilon \sim \mathcal{N}(0, \sigma^2) \]</span></p>
<p>We fit the four models to our available obseravtions <span class="math inline">\(y\)</span>. The summary statistics is shown in Table below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">get.statinfo &lt;-<span class="st"> </span><span class="cf">function</span>(model.list, model.titles, idx) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="dt">Model =</span> model.titles[idx],</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="dt">k =</span> <span class="kw">length</span>(model.list[[idx]]<span class="op">$</span>coefficients),</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="dt">n =</span> <span class="kw">nobs</span>(model.list[[idx]]),</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="dt">df =</span> <span class="kw">df.residual</span>(model.list[[idx]]), <span class="co"># n - k</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="dt">SSE =</span> <span class="kw">round</span>(<span class="kw">sum</span>(model.list[[idx]]<span class="op">$</span>residuals <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="dt">MSE =</span> <span class="kw">round</span>((<span class="kw">sum</span>(model.list[[idx]]<span class="op">$</span>residuals <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">nobs</span>(model.list[[idx]]), <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">statinfo &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  <span class="kw">seq</span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="dt">.f =</span> <span class="cf">function</span>(.)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="kw">get.statinfo</span>(model.list, model.titles, .)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">  </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, .)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">knitr<span class="op">::</span><span class="kw">kable</span>(</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">  statinfo,</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  <span class="dt">caption =</span> <span class="st">&#39;Summary statistics for fitting the four example models to the training data.&#39;</span>,</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  <span class="dt">booktabs =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">)</a></code></pre></div>
<table>
<caption><span id="tab:02-get-statinfo">Table 2.1: </span>Summary statistics for fitting the four example models to the training data.</caption>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">k</th>
<th align="right">n</th>
<th align="right">df</th>
<th align="right">SSE</th>
<th align="right">MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Linear model</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">18</td>
<td align="right">89005</td>
<td align="right">4450</td>
</tr>
<tr class="even">
<td align="left">Quadratic model</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">17</td>
<td align="right">26197</td>
<td align="right">1310</td>
</tr>
<tr class="odd">
<td align="left">Polynomial of degree 15</td>
<td align="right">16</td>
<td align="right">20</td>
<td align="right">4</td>
<td align="right">8700</td>
<td align="right">435</td>
</tr>
<tr class="even">
<td align="left">Exponential model</td>
<td align="right">2</td>
<td align="right">20</td>
<td align="right">18</td>
<td align="right">638936</td>
<td align="right">31947</td>
</tr>
</tbody>
</table>
<p>The <span class="math inline">\(MSE\)</span> between model and training data is often called <em>training</em> <span class="math inline">\(MSE\)</span>. But to asses the model performance we are usually not interested in the <em>training</em> <span class="math inline">\(MSE\)</span>. Instead, we are interested in how well our model performs on new observations – the <em>test</em> <span class="math inline">\(MSE\)</span>. Let us compute the test <span class="math inline">\(MSE\)</span> of the four example models for 100 new observations. Here, a new observation means a new sample drawn from the same population of observations as the training data set <span class="math inline">\(y\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">.compute.test.MSE &lt;-<span class="st"> </span><span class="cf">function</span>(model.list, seed, idx) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  test.data &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">20</span>), </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                              <span class="dt">y =</span> <span class="kw">jitter</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">amount =</span> <span class="dv">60</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  pred.y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">predict.lm</span>(model.list[[idx]], test.data))</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  test.MSE &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mean</span>((test.data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>pred.y) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="kw">return</span>(test.MSE)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># compute new test MSEs</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">n.models &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">n.obs &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">test.MSEs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="kw">seq</span>(n.models),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="dt">.f =</span> <span class="cf">function</span>(.) <span class="kw">lapply</span>(<span class="kw">seq</span>(n.obs), </a>
<a class="sourceLine" id="cb2-15" data-line-number="15">       <span class="cf">function</span>(x) <span class="kw">.compute.test.MSE</span>(model.list, x, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">  </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, .)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co"># convert list to tibble </span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">df.test.MSEs &lt;-<span class="st"> </span>test.MSEs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="st">  </span><span class="kw">do.call</span>(<span class="st">&quot;cbind&quot;</span>, .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="st">  </span>magrittr<span class="op">::</span><span class="kw">set_colnames</span>(model.titles) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="st">  </span>tibble<span class="op">::</span><span class="kw">as.tibble</span>(.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">Type =</span> <span class="st">&#39;Test MSE&#39;</span>)</a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co"># plot results</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25">.plot.hist &lt;-<span class="st"> </span><span class="cf">function</span>(df, model.titles, idx.model) {</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">  ggplot2<span class="op">::</span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="st">    </span><span class="kw">geom_histogram</span>(</a>
<a class="sourceLine" id="cb2-28" data-line-number="28">      <span class="kw">aes</span>(<span class="dt">x =</span> df[[idx.model]]), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">20</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="st">    </span><span class="kw">theme_book</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> model.titles[idx.model], <span class="dt">x =</span> df<span class="op">$</span>Type, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="st">    </span><span class="kw">geom_vline</span>(</a>
<a class="sourceLine" id="cb2-32" data-line-number="32">      <span class="dt">xintercept =</span> <span class="kw">median</span>(df[[idx.model]]), <span class="dt">lty =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lwd =</span> <span class="fl">1.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">}</a>
<a class="sourceLine" id="cb2-35" data-line-number="35">hist.MSEs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">  <span class="kw">seq</span>(n.models),</a>
<a class="sourceLine" id="cb2-37" data-line-number="37">  <span class="dt">.f =</span> <span class="cf">function</span>(.)<span class="kw">.plot.hist</span>(df.test.MSEs, model.titles, .)</a>
<a class="sourceLine" id="cb2-38" data-line-number="38">)</a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co"># show plots</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="kw">invisible</span>(<span class="kw">lapply</span>(hist.MSEs, <span class="cf">function</span>(x) methods<span class="op">::</span><span class="kw">show</span>(x)))</a></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_bar).</code></pre>
<div class="figure" style="text-align: left"><span id="fig:02-test-MSE"></span>
<img src="model-selection-intro_files/figure-html4/02-test-MSE-1.png" alt="Histogram of test MSEs computed on 100 new observations." width="50%" /><img src="model-selection-intro_files/figure-html4/02-test-MSE-2.png" alt="Histogram of test MSEs computed on 100 new observations." width="50%" /><img src="model-selection-intro_files/figure-html4/02-test-MSE-3.png" alt="Histogram of test MSEs computed on 100 new observations." width="50%" /><img src="model-selection-intro_files/figure-html4/02-test-MSE-4.png" alt="Histogram of test MSEs computed on 100 new observations." width="50%" />
<p class="caption">
Figure 2.1: Histogram of test MSEs computed on 100 new observations.
</p>
</div>
<p>Now, let us compute the <strong>training</strong> <span class="math inline">\(MSE\)</span> for 100 new observations and compare it to the <strong>test</strong> <span class="math inline">\(MSE\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">.fit.new.obs &lt;-<span class="st"> </span><span class="cf">function</span>(model.list, seed){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw">set.seed</span>(seed)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  test.data &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">20</span>), <span class="dt">y =</span> <span class="kw">jitter</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">amount =</span> <span class="dv">60</span>))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  new.fit &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="kw">seq</span>(<span class="kw">length</span>(model.list)),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="dt">.f =</span> <span class="cf">function</span>(.) <span class="kw">lm</span>(<span class="kw">formula</span>(model.list[[.]]), test.data)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="kw">return</span>(new.fit)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">.get.MSE &lt;-<span class="st"> </span><span class="cf">function</span>(list.of.fits, idx.fit, idx.model){</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  MSE =<span class="st"> </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">    </span><span class="kw">round</span>((<span class="kw">sum</span>(list.of.fits[[idx.fit]][[idx.model]]<span class="op">$</span>residuals <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="st">    </span><span class="kw">nobs</span>(list.of.fits[[idx.fit]][[idx.model]]), <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  <span class="kw">return</span>(MSE)</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co"># fit models to new obserations and store in list</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">n.obs &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># we fit the four models </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">n.models &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">new.fits &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">  <span class="kw">seq</span>(n.obs), </a>
<a class="sourceLine" id="cb4-21" data-line-number="21">  <span class="dt">.f =</span> <span class="cf">function</span>(.) <span class="kw">.fit.new.obs</span>(model.list, .)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22">  )</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co"># get new training MSEs</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24">training.MSEs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">  <span class="kw">seq</span>(n.models),</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">  <span class="dt">.f =</span> <span class="cf">function</span>(.) <span class="kw">lapply</span>(<span class="kw">seq</span>(n.obs), </a>
<a class="sourceLine" id="cb4-27" data-line-number="27">       <span class="cf">function</span>(x) <span class="kw">.get.MSE</span>(new.fits, x, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="st">  </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, .)</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">)</a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co"># convert list to tibble and merge with df.test.MSEs</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31">df.MSEs &lt;-<span class="st"> </span>training.MSEs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="st">  </span><span class="kw">do.call</span>(<span class="st">&quot;cbind&quot;</span>, .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="st">  </span>magrittr<span class="op">::</span><span class="kw">set_colnames</span>(model.titles) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="st">  </span><span class="kw">as.tibble</span>(.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">Type =</span> <span class="st">&#39;training MSE&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(df.test.MSEs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">gather</span>(Model, MSE, <span class="op">-</span>Type)</a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co"># define order of models (how they should appear in plot)</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39">df.MSEs<span class="op">$</span>Model &lt;-<span class="st"> </span><span class="kw">factor</span>(df.MSEs<span class="op">$</span>Model, </a>
<a class="sourceLine" id="cb4-40" data-line-number="40">  <span class="dt">levels=</span><span class="kw">c</span>(model.titles[<span class="kw">length</span>(model.titles)], model.titles[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(model.titles)<span class="op">-</span><span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co"># plot all training MSEs and test MSEs </span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42">ggplot2<span class="op">::</span><span class="kw">ggplot</span>(df.MSEs, </a>
<a class="sourceLine" id="cb4-43" data-line-number="43">                <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(Model), <span class="dt">y =</span> MSE)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44"><span class="st">  </span><span class="kw">scale_shape_discrete</span>(<span class="dt">solid=</span>F) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Type), </a>
<a class="sourceLine" id="cb4-46" data-line-number="46">             <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">stroke =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Type), <span class="dt">width =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-48" data-line-number="48"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Model&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;MSE&#39;</span>, <span class="dt">title =</span> <span class="st">&#39;&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="st">  </span><span class="kw">background_grid</span>(<span class="dt">major=</span> <span class="st">&quot;y&quot;</span>, <span class="dt">colour.major=</span><span class="st">&quot;grey40&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-50" data-line-number="50"><span class="st">  </span><span class="kw">scale_y_log10</span>(</a>
<a class="sourceLine" id="cb4-51" data-line-number="51">    <span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="op">^</span>x),</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">    <span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">trans_format</span>(<span class="st">&quot;log10&quot;</span>, scales<span class="op">::</span><span class="kw">math_format</span>(<span class="dv">10</span><span class="op">^</span>.x))) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53"><span class="st">  </span><span class="kw">annotation_logticks</span>(<span class="dt">sides =</span> <span class="st">&#39;lr&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-54" data-line-number="54"><span class="st">  </span><span class="kw">theme_book</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-55" data-line-number="55"><span class="st">  </span><span class="kw">panel_border</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-57" data-line-number="57"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Exp.&quot;</span>, <span class="st">&quot;Linear&quot;</span>, <span class="st">&quot;Quadr.&quot;</span>, <span class="st">&quot;Polyn. 15&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: left"><span id="fig:02-comparison-MSE"></span>
<img src="model-selection-intro_files/figure-html4/02-comparison-MSE-1.png" alt="Comparison of training and test MSEs computed on 100 new data sets." width="100%" />
<p class="caption">
Figure 2.2: Comparison of training and test MSEs computed on 100 new data sets.
</p>
</div>
<p>The polynomial of degree 15 has the best <em>training</em> <span class="math inline">\(MSE\)</span> but the worse <em>test</em> <span class="math inline">\(MSE\)</span>. This behavior is often called <strong>overfitting</strong>. In the next section we will show that this results from high <strong>model variance</strong> (error due to <strong>estimation</strong>) and low <strong>bias</strong> (error due to <strong>approximation</strong>). The linear model performs bad on both data sets. Note that the <span class="math inline">\(MSE\)</span> of the linear model does not change as as much as for <span class="math inline">\(\hat{f}_3\)</span> – this indicates that the model variance of <span class="math inline">\(\hat{f}_1\)</span> is rather low and that the high <span class="math inline">\(MSE\)</span> results from high bias. The quadratic model performs well on both data sets suggesting a low model variance and a low bias. And indeed, this model was used to generate the data for this example.</p>
</div>
<div id="error-decomposition" class="section level2">
<h2><span class="header-section-number">2.3</span> Error decomposition</h2>
<p>[work in progress]</p>
<p>Assume we know the real model <span class="math inline">\(f\)</span> that gives rise to some real observations <span class="math inline">\(y\)</span> for values <span class="math inline">\(x\)</span> described by <span class="math inline">\(y = f(x) + \epsilon\)</span>, with random noise <span class="math inline">\(\epsilon \sim \mathcal{N}(0, \sigma^2)\)</span>.</p>
<p>We are interested in the quality of fit for a given model <span class="math inline">\(\hat{f}\)</span>. It can be shown, that the expected test <span class="math inline">\(MSE\)</span> for <span class="math inline">\(\hat{f}(x_i)\)</span> can always be decomposed into the sum of the following three components:
<span class="math display">\[ E \left( y(x_i) - \hat{f}(x_i) \right)^2 = \mathrm{Var}(\hat{f}(x_i)) + \left( \mathrm{Bias} (\hat{f}(x_i)) \right)^2 + \mathrm{Var}(\epsilon)\]</span></p>
<ol style="list-style-type: decimal">
<li><strong>Variance of the fitted model</strong>: <span class="math inline">\(\mathrm{Var}(\hat{f}(x_i)) = E(\hat{f}(x_i)^2) - E(\hat{f}(x_i))^2\)</span>
<ul>
<li>The variance of <span class="math inline">\(\hat{f}(x_i)\)</span> refers to the amount by which model <span class="math inline">\(\hat{f}\)</span> would change, if we estimated it using a different training data set (changes in estimated parameters); in general, more flexible models show higher variance than less flexible models. This error term is also called <strong>error due to estimation</strong>.</li>
</ul></li>
</ol>
<div class="figure" style="text-align: left"><span id="fig:02-model-var"></span>
<img src="model-selection-intro_files/figure-html4/02-model-var-1.png" alt="Visualization of model variance: The example models were fitted to four different testing data sets." width="50%" /><img src="model-selection-intro_files/figure-html4/02-model-var-2.png" alt="Visualization of model variance: The example models were fitted to four different testing data sets." width="50%" /><img src="model-selection-intro_files/figure-html4/02-model-var-3.png" alt="Visualization of model variance: The example models were fitted to four different testing data sets." width="50%" /><img src="model-selection-intro_files/figure-html4/02-model-var-4.png" alt="Visualization of model variance: The example models were fitted to four different testing data sets." width="50%" />
<p class="caption">
Figure 2.3: Visualization of model variance: The example models were fitted to four different testing data sets.
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Squared bias of the fitted model</strong>: <span class="math inline">\(\left( \mathrm{Bias} (\hat{f}(x_i)) \right)^2 = \left( E\left(\hat{f}(x_i)\right) - f(x_i) \right)^2\)</span>
<ul>
<li>The squared bias of <span class="math inline">\(\hat{f}(x_i)\)</span> is also called <strong>error due to approximation</strong>. More flexible models result in lower bias (but higher variance), while less flexible models result in high bias (and lower variance).</li>
</ul></li>
<li><strong>Variance due to measurement noise</strong>: <span class="math inline">\(\mathrm{Var}(\epsilon) = \sigma^2\)</span>
<ul>
<li>The variance of the error terms, which is irreducible.n</li>
</ul></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["model-selection-intro.pdf", "model-selection-intro.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
